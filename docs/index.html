<!DOCTYPE html>

<script>
    window.addEventListener("DOMContentLoaded", function() {
        nsbp = "\u00a0"

        // List of page.
        const fragment = document.createDocumentFragment();
        Object
            .keys(CONTENT_META_DATA)
            .map(key => CONTENT_META_DATA[key])
            .sort((a, b) => (a.date < b.date) ? 1 : -1)
            .forEach(function (page) {
                const li = document.createElement("li");
                li.innerHTML = `
                    <div>${page.date}\u00a0<a href='${page.path}'>${page.title}</a></div>
                `;

                page.tags.forEach((tag_name) => {
                    const tag_link = document.createElement('a');
                    tag_link.classList.add('tag');
                    tag_link.appendChild(document.createTextNode('#' + tag_name));
                    tag_link.href = './tag.html?tag=' + tag_name;

                    li.children[0].appendChild(document.createTextNode(nsbp));
                    li.children[0].appendChild(tag_link);
                });

                fragment.appendChild(li);
            });

        document
            .getElementById("contents-list")
            .appendChild(fragment);

        // List of tag.
        const tag_set = new Set(
            Object
                .keys(CONTENT_META_DATA)
                .map(key => CONTENT_META_DATA[key].tags)
                .flat()
        );

        const fragment2 = document.createDocumentFragment();
        tag_set.forEach(function (tag_name) {
            const elem_a = document.createElement("a");
            elem_a.appendChild(document.createTextNode(tag_name));
            elem_a.href = "./tag.html?tag=" + tag_name;

            const elem_tag = document.createElement("tag");
            elem_tag.appendChild(elem_a);

            fragment2.appendChild(elem_tag);
            fragment2.appendChild(document.createTextNode(" "));
        });
        document
            .getElementById("tags-list")
            .appendChild(fragment2);
    });
</script>

<html lang="ja">
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="style.css">
        <script type="text/javascript" src="data.js"></script>
        <title>資料置き場</title>
    </head>

    <style>#contents-list li {margin-bottom: 1ex;}</style>

    <body>
        <h1>資料置き場</h1>
        <p>輪講などの資料を置くページです。</p>
        <br>

        <h2>ページ一覧</h2>
        <ul id = "contents-list">
        </ul>
        <br>

        <h2>タグ一覧</h2>
        <div style="overflow-wrap: keep-all;">
            <p id = "tags-list"></p>
        </div>
    </body>
</html>
